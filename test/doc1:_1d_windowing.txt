using DataTreatments
using SoleXplorer

A = rand(1150, 1150);
B = rand(2500);

points = length(B)
SX_w = MovingWindow(window_size=10, window_step=5)
SX_movingwindow = SX_w(points)
DT_w = movingwindow(winsize=10, winstep=5)
DT_movingwindow = @evalwindow points DT_w
SX_movingwindow == DT_movingwindow

@btime begin
    points = length(B)
    SX_w = MovingWindow(window_size=10, window_step=5)
    SX_movingwindow = SX_w(points)
end
# 1.344 μs (5 allocations: 7.91 KiB)

@btime begin
    DT_w = movingwindow(winsize=10, winstep=5)
    DT_movingwindow = @evalwindow B DT_w
end
# 1.273 μs (7 allocations: 11.91 KiB)

SX_w = WholeWindow()
SX_wholewindow = SX_w(points)
DT_w = wholewindow()
DT_wholewindow = @evalwindow points DT_w
SX_wholewindow == DT_wholewindow

@btime begin
    points = length(B)
    SX_w = WholeWindow()
    SX_wholewindow = SX_w(points)
end
# 849.787 ns (15 allocations: 448 bytes)

@btime begin
    DT_w = wholewindow()
    DT_wholewindow = @evalwindow B DT_w
end
# 58.831 ns (7 allocations: 192 bytes)

SX_w = SplitWindow(nwindows=11)
SX_splitwindow = SX_w(points)
DT_w = splitwindow(nwindows=11)
DT_splitwindow = @evalwindow points DT_w
length(DT_splitwindow) == 11

@btime begin
    points = length(B)
    SX_w = SplitWindow(nwindows=11)
    SX_splitwindow = SX_w(points)
end
# 4.385 μs (102 allocations: 2.89 KiB)

@btime begin
    DT_w = splitwindow(nwindows=11)
    DT_splitwindow = @evalwindow B DT_w
end
# 169.756 ns (6 allocations: 544 bytes)

SX_w = AdaptiveWindow(nwindows=11, relative_overlap=0.1)
SX_adaptivewindow = SX_w(points)
DT_w = adaptivewindow(nwindows=11, overlap=0.1)
DT_adaptivewindow = @evalwindow points DT_w
length(DT_splitwindow) == 11

@btime begin
        points = length(B)
    SX_w = AdaptiveWindow(nwindows=11, relative_overlap=0.1)
    SX_adaptivewindow = SX_w(points)
end
# 4.342 μs (102 allocations: 2.89 KiB)

@btime begin
    DT_w = adaptivewindow(nwindows=11, overlap=0.1)
    DT_adaptivewindow = @evalwindow B DT_w
end
# 167.503 ns (6 allocations: 544 bytes)

#####################################################################
@btime begin
    Xresult1 = similar(Xm)
    for i in eachindex(Xm)
        @inbounds Xresult1[i] = _aggregate(Xm[i], intervals)
    end
end;
# 2.138 s (498981 allocations: 25.16 MiB)

@btime begin
    Xresult1 = similar(Xm)
    Threads.@threads for i in eachindex(Xm)
        @inbounds Xresult1[i] = _aggregate(Xm[i], intervals)
    end
end;
# 325.657 ms (299581 allocations: 20.60 MiB)

@btime aggregate(Xm, intervals)
